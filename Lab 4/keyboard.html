<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Step 4 - Collision Detection</title>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <style>
    canvas {
      border: 1px solid grey;
      display: block;
      margin: auto;
    }
  </style>
</head>

<body>
  <canvas id="canvas-for-ball" width="600" height="400"></canvas>

  <script>
    const canvas = document.getElementById("canvas-for-ball");
    const ctx = canvas.getContext("2d");

    // ------------------ Paddle class (Circle) ------------------
    class Paddle {
      constructor(x, y, radius, color) {
        this.x = x;
        this.y = y;
        this.radius = radius;
        this.color = color;
        this.speed = 6;
        this.movingUp = false;
        this.movingDown = false;
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.closePath();
      }

      move() {
        if (this.movingUp && this.y - this.radius > 0) {
          this.y -= this.speed;
        }
        if (this.movingDown && this.y + this.radius < canvas.height) {
          this.y += this.speed;
        }
      }
    }

    // ------------------ Ball class ------------------
    class Ball {
      constructor(x, y, dx, dy, radius, color) {
        this.x = x;
        this.y = y;
        this.dx = dx;
        this.dy = dy;
        this.radius = radius;
        this.color = color;
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.closePath();
      }

      move() {
        this.x += this.dx;
        this.y += this.dy;

        // Bounce off top & bottom walls
        if (this.y - this.radius < 0 || this.y + this.radius > canvas.height) {
          this.dy *= -1;
        }
      }
    }

    // ------------------ Collision Detection ------------------
    function detectCollision(ball, paddle) {
      const dx = ball.x - paddle.x;
      const dy = ball.y - paddle.y;
      const distance = Math.sqrt(dx * dx + dy * dy);

      // Returns true if the distance is smaller than sum of radii
      return distance < ball.radius + paddle.radius;
    }

    // ------------------ Object creation ------------------
    const paddle = new Paddle(50, 200, 30, "blue");
    const matchBall = new Ball(300, 200, 3, 2, 10, "red");

    // ------------------ Keyboard controls ------------------
    $(document.body).on("keydown", function (e) {
      switch (e.which) {
        case 38: // up arrow
          paddle.movingUp = true;
          break;
        case 40: // down arrow
          paddle.movingDown = true;
          break;
      }
    });

    $(document.body).on("keyup", function (e) {
      switch (e.which) {
        case 38:
          paddle.movingUp = false;
          break;
        case 40:
          paddle.movingDown = false;
          break;
      }
    });

    // ------------------ Game loop ------------------
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      matchBall.move();
      matchBall.draw();

      paddle.move();
      paddle.draw();

      // Collision detection example
      if (detectCollision(matchBall, paddle)) {
        ctx.font = "20px Arial";
        ctx.fillStyle = "red";
        ctx.fillText("Collision!", canvas.width / 2 - 50, 50);
      }

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>

