<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Step 10 - Paddle Mouse Control</title>
  <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
  <style>
    canvas {
      border: 1px solid grey;
      display: block;
      margin: auto;
    }
  </style>
</head>
<body>
  <canvas id="canvas-for-ball" width="600" height="400"></canvas>

  <script>
    const canvas = document.getElementById("canvas-for-ball");
    const ctx = canvas.getContext("2d");

    // ------------------ Paddle class ------------------
    class Paddle {
      constructor(x, y, radius, color) {
        this.x = x;
        this.y = y;
        this.radius = radius;
        this.color = color;
        this.speed = 6;
        this.score = 0;
      }

      draw() {
        const gradient = ctx.createRadialGradient(
          this.x, this.y, this.radius / 4,
          this.x, this.y, this.radius
        );
        gradient.addColorStop(0, "white");
        gradient.addColorStop(1, this.color);

        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();
        ctx.closePath();

        ctx.font = "18px Arial";
        ctx.fillStyle = "black";
        if (this.x < canvas.width / 2) {
          ctx.fillText("Score: " + this.score, this.x + 40, this.y - 40);
        } else {
          ctx.fillText("Score: " + this.score, this.x - 120, this.y - 40);
        }
      }

      moveUp() {
        if (this.y - this.radius > 0) this.y -= this.speed;
      }

      moveDown() {
        if (this.y + this.radius < canvas.height) this.y += this.speed;
      }

      moveTo(y) {
        // Move paddle to a specific Y-coordinate
        if (y - this.radius < 0) {
          this.y = this.radius;
        } else if (y + this.radius > canvas.height) {
          this.y = canvas.height - this.radius;
        } else {
          this.y = y;
        }
      }
    }

    // ------------------ Ball class ------------------
    class Ball {
      constructor(x, y, dx, dy, radius, color) {
        this.x = x;
        this.y = y;
        this.dx = dx;
        this.dy = dy;
        this.radius = radius;
        this.color = color;
      }

      draw() {
        const gradient = ctx.createRadialGradient(
          this.x, this.y, this.radius / 4,
          this.x, this.y, this.radius
        );
        gradient.addColorStop(0, "white");
        gradient.addColorStop(1, this.color);

        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();
        ctx.closePath();
      }

      move() {
        this.x += this.dx;
        this.y += this.dy;

        if (this.y - this.radius < 0 || this.y + this.radius > canvas.height) {
          this.dy *= -1;
        }
      }
    }

    // ------------------ Collision Detection ------------------
    function detectCollision(ball, paddle) {
      const dx = ball.x - paddle.x;
      const dy = ball.y - paddle.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      return distance < ball.radius + paddle.radius;
    }

    // ------------------ Message System ------------------
    let showMessage = false;
    let message = "";

    function showCollisionMessage(text) {
      message = text;
      showMessage = true;
      setTimeout(() => (showMessage = false), 1000);
    }

    // ------------------ Objects ------------------
    const paddle1 = new Paddle(50, 200, 30, "blue");
    const paddle2 = new Paddle(550, 200, 30, "green");
    const matchBall = new Ball(300, 200, 3, 2, 10, "red");

    // ------------------ Keyboard Controls ------------------
    $(document.body).on("keydown", function (e) {
      switch (e.which) {
        case 38: paddle1.moveUp(); break;
        case 40: paddle1.moveDown(); break;
        case 87: paddle2.moveUp(); break;
        case 83: paddle2.moveDown(); break;
      }
    });

    // ------------------ Mouse Control for Paddle 1 ------------------
    $(canvas).on("mousemove", function(e) {
      const rect = canvas.getBoundingClientRect();
      const mouseY = e.clientY - rect.top;
      paddle1.moveTo(mouseY);
    });

    // ------------------ Game Loop ------------------
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      matchBall.move();
      matchBall.draw();

      paddle1.draw();
      paddle2.draw();

      if (detectCollision(matchBall, paddle1)) {
        matchBall.dx *= -1;
        showCollisionMessage("Paddle 1 Hit!");
        paddle1.score++;
      }

      if (detectCollision(matchBall, paddle2)) {
        matchBall.dx *= -1;
        showCollisionMessage("Paddle 2 Hit!");
        paddle2.score++;
      }

      if (matchBall.x - matchBall.radius < 0) {
        paddle1.score--;
        matchBall.x = canvas.width / 2;
        matchBall.dx *= -1;
      }

      if (matchBall.x + matchBall.radius > canvas.width) {
        paddle2.score--;
        matchBall.x = canvas.width / 2;
        matchBall.dx *= -1;
      }

      if (showMessage) {
        ctx.font = "24px Arial";
        ctx.fillStyle = "red";
        ctx.fillText(message, canvas.width / 2 - 60, 50);
      }

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>